import u,{resolve as d}from"path";import{run as h}from"vite-plugin-run";import{readFileSync as y}from"fs";var g={sail:!1,types:!0,typesOnly:!1,delay:100,throttle:300,only:[],except:[]},s="rzl-app/ziggy",v=()=>{try{let o=d(process.cwd(),"composer.json"),e=JSON.parse(y(o,"utf-8"));if(!e.require?.[s])throw new Error(`${s} not found in composer.json dependencies`);let r=e.require[s],t=r.match(/^[~^><]?(\d+)/);if(!t)throw new Error(`Invalid version format for ${s}: ${r}`);return t[1]}catch(o){throw o instanceof Error&&o.code==="ENOENT"?new Error("composer.json not found in project root"):o}},f=(o,e)=>{let r=[e.sail&&!process.env.LARAVEL_SAIL?"sail":"php","artisan","rzl-ziggy:generate"];return e.group&&r.push("--group",e.group),e.url&&r.push("--url",e.url),["1","2"].includes(o)&&(e.types&&r.push("--types"),e.typesOnly&&r.push("--types-only"),o==="1"&&(e.only.length>0&&r.push("--only",e.only.join(",")),e.except.length>0&&r.push("--except",e.except.join(",")))),r},w=(o={})=>{try{let e=v(),{delay:r,throttle:t,...p}=o,i=f(e,{...g,...p}),{configResolved:a,handleHotUpdate:c}=h(process.env.NODE_ENV==="development"?[{delay:r,throttle:t,name:"rzl-ziggy-generator",run:i,pattern:["routes/**/*.php",".*.env",".*.*.env",".env.*",".env.*.*"],condition:n=>{let l=u.relative(process.cwd(),n);return n.includes("/routes/")&&n.endsWith(".php")||n.includes("/")&&n.includes(".env")||/^routes\/.*\.php$/.test(l.replace(/\\/g,"/"))||/\.env(\..+)?$/.test(l)}}]:[]);return{name:"rzl-ziggy-plugin",configResolved:a,handleHotUpdate:c}}catch(e){if(console.error("[rzl-vite-plugin-ziggy] Error: "),e instanceof Error)console.error(e.message),process.env.NODE_ENV==="development"&&console.error(e.stack);else throw e}return{}};export{w as default};
