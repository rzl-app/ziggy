import y from"path";import o from"chalk";import{run as x}from"vite-plugin-run";var h={sail:!1,types:!0,typesOnly:!1,delay:100,throttle:300,only:[],except:[]};import{readFileSync as v}from"fs";import{resolve as E}from"path";import n from"chalk";var l=n.bgHex("#00bcd4").black.bold(" RZL-ZIGGY "),c={info:(r,e)=>{console.log(`
${l} ${n.blueBright(r)} ${n.gray("\u2192")} ${n.white(e)}`)},success:(r,e)=>{console.log(`
${l} ${n.greenBright("\u2705 "+r)} ${n.gray("\u2192")} ${n.whiteBright(e)}`)},warn:(r,e)=>{console.warn(`
${l} ${n.yellow("\u26A0\uFE0F  "+r)} ${n.gray("\u2192")} ${n.yellowBright(e)}`)},error:(r,e)=>{console.error(`
${l} ${n.redBright("\u274C "+r)} ${n.gray("\u2192")} ${n.red(e)}`)},throw:(r,e)=>{throw e instanceof Error?(c.error(r,e.message),process.env.NODE_ENV==="development"&&console.error(n.gray(e.stack)),e):(c.error(r,"Unknown error occurred"),new Error(typeof e=="string"?e:"Unknown error"))},raw:r=>console.log(`
${l} ${r}`)};function i(r,e){throw c.throw(r,e),typeof e=="string"?new Error(e):e}var g="rzl-app/ziggy",m=()=>{try{let r=E(process.cwd(),"composer.json"),e=JSON.parse(v(r,"utf-8"));e.require?.[g]||i("composer.json",`${g} not found in composer.json dependencies`);let t=e.require[g],p=t.match(/^[~^><]?(\d+)/);p||i("Version Format",`Invalid version format for ${g}: ${t}`);let a=p[1];return c.success("Composer Package",`${g} v${a}`),a}catch(r){r instanceof Error&&r.code==="ENOENT"&&i("composer.json",`File not found in ${process.cwd()}`),r instanceof Error&&i("Version Fetch Failed",r),i("Unknown Error","Something exploded \u{1F4A3}")}};var f=(r,e)=>{let t=[e.sail&&!process.env.LARAVEL_SAIL?"sail":"php","artisan","rzl-ziggy:generate"];return e.group&&t.push("--group",e.group),e.url&&t.push("--url",e.url),["1","2"].includes(r)&&(e.types&&t.push("--types"),e.typesOnly&&t.push("--types-only"),r==="1"&&(e.only.length>0&&t.push("--only",e.only.join(",")),e.except.length>0&&t.push("--except",e.except.join(",")))),t};var S=(r={})=>{try{let e=m(),{delay:t,throttle:p,...a}=r,d=f(e,{...h,...a}),{configResolved:$,handleHotUpdate:w}=x(process.env.NODE_ENV==="development"?[{delay:t,throttle:p,onFileChanged:({file:s})=>{let u=y.relative(process.cwd(),s).replace(/\\/g,"/");console.log(`
\u{1F6F0}\uFE0F  ${o.cyanBright("Live Watcher")} ${o.gray("detected change in")} ${o.yellowBright(u)}`),console.log(`${o.hex("#ff6f00")("\u{1F501} Rerunning")} ${o.bold.cyan(d.join(" "))} ${o.gray("...syncing fresh routes \u{1F6A6}")}
`)},name:"rzl-ziggy-generator",run:d,pattern:["routes/**/*.php",".*.env",".*.*.env",".env.*",".env.*.*"],condition:s=>{let u=y.relative(process.cwd(),s);return s.includes("/routes/")&&s.endsWith(".php")||s.includes("/")&&s.includes(".env")||/^routes\/.*\.php$/.test(u.replace(/\\/g,"/"))||/\.env(\..+)?$/.test(u)}}]:[]);return{name:"rzl-ziggy-plugin",configResolved:$,handleHotUpdate:w}}catch(e){if(console.error(`
${o.bgRed.white.bold(" RZL ZIGGY ERROR ")} ${o.redBright("An error occurred in")} ${o.yellow("[rzl-app-ziggy/vite-plugin]")} \u{1F6A8}`),e instanceof Error)console.error(`${o.red("\u274C Message:")} ${o.white(e.message)}`),process.env.NODE_ENV==="development"?console.error(`${o.gray("\u{1F4CD} Stack Trace:")}
${o.dim(e.stack||"")}`):console.error(`${o.gray("\u2139\uFE0F  Tip:")} Run in ${o.cyan("development")} mode to see stack trace.`);else throw console.error(`${o.red("\u2753 Unknown error type thrown:")}`),e}return{}};export{S as default};
